<!DOCTYPE html>
<html lang="en">

<head>
  <base href=".">

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">

  <link rel="stylesheet" href="javascript/bootstrap/css/bootstrap.min.css">

  <title>求求你别问了</title>
</head>

<body>
  <div class="container">
    <main class="my-3">
      <h1 class="mb-5">去哪找答案？</h1>
      <button id="tellme" class="btn btn-secondary mb-3">求求你告诉我！</button>
      <div id="answer" style="display: none;">
        <div class="input-group mb-3">
          <input id="input" type="text" class="form-control" placeholder="这里填问题" aria-label="这里填问题">
          <button id="search" style="display: none;" class="btn btn-primary ml-1">搜索一下</button>
        </div>
        <div id="generate" style="display: none;">
          <div class="input-group mb-3">
            <input id="output" type="text" class="form-control" placeholder="这里找答案" aria-label="这里找答案">
          </div>
          <button id="copy" style="display: none;" class="btn btn-secondary mb-3">复制</button>
          <button id="jump" class="btn btn-secondary mb-3">去找答案</button>
        </div>
      </div>
    </main>
  </div>

  <script src="javascript/jquery/jquery.min.js"></script>
  <script src="js/suffix.js"></script>
  <script>
    function decodeSearch(search) {
      let ans = {};
      let kvs = search.slice(1).split('&');
      for (let i = 0; i < kvs.length; ++i) {
        let [key, value] = kvs[i].split('=');
        ans[decodeURIComponent(key)] = decodeURIComponent(value);
      }
      return ans;
    }
    function encodeSearch(search) {
      let kvs = [];
      for (let key in search) {
        kvs.push(encodeURIComponent(key) + '=' + encodeURIComponent(search[key]));
      }
      return '?' + kvs.join('&');
    }

    $("#copy").click(function () {
      eOutput.setSelectionRange(0, eOutput.value.length);
      eOutput.select();
      document.execCommand("Copy");
    });
    $("#jump").click(function () {
      if ($("#output").val() === "") {
        $("#input").val("先填问题好不好？");
      } else {
        location.href = $("#output").val();
      }
    });

    location.originpath = location.href;
    if (location.search.length !== 0) location.originpath = location.originpath.slice(0, -location.search.length);
    let question = decodeSearch(location.search).wd;
    let t = 320;
    let [tInstant, tPause, tClick, tWait] = [t / 8, t / 2, t, t * 2];
    if (question === undefined || question === "") {
      $("#tellme").click(function () {
        $("#answer").show();
        $("#generate").show();

        let prev = "";
        setInterval(() => {
          if ($("#input").val() !== prev) {
            $("#output").val(location.originpath + encodeSearch({ wd: $("#input").val() }));
            prev = $("#input").val();
          }
        }, tPause);

        $("#tellme").off("click");
      });

    } else {
      $("title").html(question + "（" + titleSuffixs[Math.round(Math.random() * titleSuffixs.length)]);

      $("#tellme").click(function () {
        $("#answer").show();

        setTimeout(() => {
          let questionIndex = 0;
          let timer = setInterval(() => {
            $("#input").val(question.substring(0, ++questionIndex));
            if (questionIndex === question.length) {
              setTimeout(() => {
                $("#search").show();
                setTimeout(() => {
                  $("#search").addClass("active");
                  setTimeout(() => {
                    $("#search").removeClass("active");
                    location.href = 'https://www.baidu.com/s?wd=' + encodeURIComponent($("#input").val());
                  }, tClick);
                }, tWait);
              }, tClick);
              clearInterval(timer);
            }
          }, tPause);
        }, tInstant);

        $("#tellme").off("click");
      });
    }

    setTimeout(() => {
      $("#tellme").focus();
      setTimeout(() => {
        $("#tellme").addClass("active");
        setTimeout(() => {
          $("#tellme").removeClass("active");
          $("#tellme").click();
        }, tClick);
      }, tWait)
    }, tWait);
  </script>
</body>

</html>